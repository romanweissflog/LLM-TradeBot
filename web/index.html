<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LLM-TradeBot Dashboard</title>
    <link rel="stylesheet" href="/static/style.css?v=35">
    <link
        href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Inter:wght@400;600&display=swap"
        rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>
    <div class="container">
        <!-- Header -->
        <header class="glass-panel header">
            <div class="logo">
                <span class="icon">ü§ñ</span>
                <h1>LLM-TradeBot: Adversarial Decision Framework <a href="https://github.com/EthanAlgoX/LLM-TradeBot"
                        target="_blank"
                        style="color: var(--neon-blue); text-decoration: none; font-size: 0.65em;">https://github.com/EthanAlgoX/LLM-TradeBot</a>
                </h1>
            </div>
            <div class="status-indicators">
                <div class="controls">
                    <button id="btn-start" class="btn-control start" title="Start Trading">‚ñ∂</button>
                    <button id="btn-pause" class="btn-control pause" title="Pause Trading">‚è∏</button>
                    <button id="btn-stop" class="btn-control stop" title="Stop System">‚èπ</button>

                    <select id="interval-selector" class="interval-selector" title="Cycle Interval">
                        <option value="0.5">30s</option>
                        <option value="1">1 min</option>
                        <option value="3" selected>3 min</option>
                        <option value="5">5 min</option>
                    </select>
                </div>
                <div class="status-item">
                    <span class="label">MODE</span>
                    <span id="sys-mode" class="value badge">LOADING</span>
                </div>
                <div class="status-item">
                    <span class="label">ENVIRONMENT</span>
                    <span id="sys-env" class="value badge">LOADING</span>
                </div>
                <div class="status-item">
                    <span class="label">CYCLE</span>
                    <span id="cycle-counter" class="value">#0</span>
                </div>
                <div class="status-item">
                    <span class="label">EQUITY</span>
                    <span id="header-equity" class="value">$0.00</span>
                </div>
            </div>
        </header>

        <!-- Main Grid -->
        <main class="dashboard-grid">

            <!-- Row 1: K-Line + Net Value -->
            <section class="row-charts">
                <!-- K-Line Chart -->
                <div class="glass-panel card kline-card">
                    <div class="chart-header">
                        <div
                            style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                            <h2 style="margin: 0;">üìâ Real-time K-Line</h2>
                            <select id="symbol-selector"
                                style="padding: 5px 10px; margin-left: 20px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 4px; color: #fff; font-size: 0.9rem; cursor: pointer;">
                                <option value="BTCUSDT" selected>BTC/USDT</option>
                                <option value="ETHUSDT">ETH/USDT</option>
                                <option value="BNBUSDT">BNB/USDT</option>
                                <option value="SOLUSDT">SOL/USDT</option>
                                <option value="ADAUSDT">ADA/USDT</option>
                            </select>
                        </div>
                    </div>
                    <div class="kline-container-wrapper">
                        <div class="tradingview-widget-container">
                            <div id="tradingview_b8265"></div>
                            <script type="text/javascript" src="https://s3.tradingview.com/tv.js"></script>
                            <script type="text/javascript">
                                // Âä®ÊÄÅ TradingView Âä†ËΩΩÂô®
                                let tvWidget = null;
                                function loadTradingViewChart(symbol) {
                                    const container = document.getElementById('tradingview_b8265');
                                    container.innerHTML = ''; // Ê∏ÖÁ©∫ÊóßÂõæË°®
                                    tvWidget = new TradingView.widget({
                                        "width": "100%",
                                        "height": "100%",
                                        "symbol": "BINANCE:" + symbol,
                                        "interval": "1",
                                        "timezone": "Asia/Shanghai",
                                        "theme": "dark",
                                        "style": "1",
                                        "locale": "zh_CN",
                                        "toolbar_bg": "#f1f3f6",
                                        "enable_publishing": false,
                                        "hide_top_toolbar": true,
                                        "save_image": false,
                                        "container_id": "tradingview_b8265"
                                    });
                                }
                                // ÂàùÂßãÂåñÂä†ËΩΩ BTC
                                loadTradingViewChart('BTCUSDT');

                                // ÁõëÂê¨ÈÄâÊã©Âô®ÂèòÂåñ
                                document.getElementById('symbol-selector').addEventListener('change', function (e) {
                                    loadTradingViewChart(e.target.value);
                                });
                            </script>
                        </div>
                    </div>
                </div>

                <!-- Net Value -->
                <div class="glass-panel card chart-composite-card">
                    <div class="chart-header">
                        <h2>üìà Net Value Curve</h2>
                        <div class="header-metrics">
                            <div class="h-metric">
                                <span class="label">Total Equity</span>
                                <span id="acc-equity" class="val">$0.00</span>
                            </div>
                            <div class="h-metric">
                                <span class="label">Wallet</span>
                                <span id="acc-wallet" class="val">$0.00</span>
                            </div>
                            <div class="h-metric">
                                <span class="label">PnL</span>
                                <span id="acc-pnl" class="val neutral">$0.00</span>
                            </div>
                        </div>
                    </div>

                    <div class="chart-container-lg">
                        <canvas id="equityChart"></canvas>
                    </div>
                </div>
            </section>

            <!-- Row 2: Decisions (Full Width) -->
            <section class="row-decisions">
                <!-- Decisions -->
                <div class="glass-panel card decision-table-card">
                    <div style="display: flex; align-items: center; margin-bottom: 10px; flex-wrap: wrap; gap: 20px;">
                        <h2 style="margin: 0;">üìã Recent Decisions</h2>

                        <!-- üîç Filter Controls (Fixed next to Title) -->
                        <div id="decision-filters" style="display: flex; gap: 10px; align-items: center;">
                            <select id="filter-symbol"
                                style="padding: 4px 8px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 4px; color: #fff; font-size: 0.8rem; cursor: pointer;">
                                <option value="all">All Symbols</option>
                                <option value="BTCUSDT">BTC</option>
                                <option value="ETHUSDT">ETH</option>
                                <option value="SOLUSDT">SOL</option>
                                <option value="BNBUSDT">BNB</option>
                            </select>
                            <select id="filter-result"
                                style="padding: 4px 8px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 4px; color: #fff; font-size: 0.8rem; cursor: pointer;">
                                <option value="all">All Results</option>
                                <option value="wait">Wait</option>
                                <option value="long">Long</option>
                                <option value="short">Short</option>
                            </select>
                        </div>

                        <!-- Position Info (Pushed to Far Right) -->
                        <div id="position-info"
                            style="font-size: 0.85rem; color: #a0aec0; display: flex; gap: 20px; align-items: center; margin-left: auto;">
                            <span id="position-count" style="color: #e0e6ed;">üìä Positions: 0</span>
                            <div id="position-details" style="display: flex; gap: 15px;">
                                <!-- Dynamic position details will be inserted here -->
                            </div>


                        </div>
                    </div>
                    <div class="table-container">
                        <table id="decision-table">
                            <thead>
                                <!-- Agent Group Header Row -->
                                <tr class="agent-group-row">
                                    <th colspan="3" class="group-system">üìä System</th>
                                    <th colspan="3" class="group-critic">‚öñÔ∏è Critic</th>
                                    <th colspan="7" class="group-strategist">üë®‚Äçüî¨ Strategist</th>
                                    <th class="group-prophet">üîÆ Prophet</th>
                                    <th colspan="2" class="group-bullbear">üêÇüêª Bull/Bear</th>
                                    <th colspan="3" class="group-guardian">üõ°Ô∏è Guardian</th>
                                </tr>
                                <!-- Column Header Row -->
                                <tr>
                                    <th title="ÂÜ≥Á≠ñÁîüÊàêÊó∂Èó¥">Time</th>
                                    <th title="Âæ™ÁéØÊ¨°Êï∞">Cycle</th>
                                    <th title="‰∫§ÊòìÂØπ">Symbol</th>
                                    <th title="ÊúÄÁªàÂÜ≥Á≠ñÂä®‰Ωú (LONG/SHORT/HOLD/WAIT)">Result</th>
                                    <th title="‰ø°ÂøÉÂ∫¶ (0-100%)">Conf</th>
                                    <th title="ÂÜ≥Á≠ñÂéüÂõ†ËØ¶ÁªÜËØ¥Êòé (ÊÇ¨ÂÅúÊü•ÁúãÂÆåÊï¥)">Reason</th>
                                    <th title="Strategist ÁªºÂêàËØÑÂàÜ (-100~+100)">Strat</th>
                                    <th title="1Â∞èÊó∂Âë®Êúü‰ø°Âè∑ (Ë∂ãÂäøT + ÈúáËç°O)">1h</th>
                                    <th title="15ÂàÜÈíüÂë®Êúü‰ø°Âè∑ (Ë∂ãÂäøT + ÈúáËç°O)">15m</th>
                                    <th title="5ÂàÜÈíüÂë®Êúü‰ø°Âè∑ (Ë∂ãÂäøT + ÈúáËç°O)">5m</th>
                                    <th title="ÊÉÖÁª™‰ø°Âè∑ (ËµÑÈáëÊµÅÂêë + ËµÑÈáëË¥πÁéá)">Sent</th>
                                    <th title="Â∏ÇÂú∫Áä∂ÊÄÅ (TREND_UP/TREND_DOWN/CHOPPY)">Regime</th>
                                    <th title="‰ª∑Ê†º‰ΩçÁΩÆ (HIGH/MIDDLE/LOW)">Position</th>
                                    <th title="PredictAgent ‰∏äÊ∂®Ê¶ÇÁéá (0-100%)">P(Up)</th>
                                    <th title="üêÇ Bull Agent Â§öÂ§¥‰ø°ÂøÉÂ∫¶ (0-100%)">üêÇBull</th>
                                    <th title="üêª Bear Agent Á©∫Â§¥‰ø°ÂøÉÂ∫¶ (0-100%)">üêªBear</th>
                                    <th title="È£éÈô©Á≠âÁ∫ß (SAFE/WARNING/DANGER)">Risk</th>
                                    <th title="Guardian ÂÆ°Ê†∏ÁªìÊûú (‚úÖÈÄöËøá / ‚õîÊã¶Êà™)">Guard</th>
                                    <th title="Â§öÂë®ÊúüÂØπÈΩêÁä∂ÊÄÅ (‚úÖ‰∏ÄËá¥ / ‚ûñÂàÜÊ≠ß)">Aligned</th>

                                </tr>
                            </thead>
                            <tbody>
                                <!-- JS Populated -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- Row 2.5: Trade History (Full Width) -->
            <section class="row-trades">
                <div class="glass-panel card trade-table-card">
                    <h2>üìú Trade History</h2>
                    <div class="table-container">
                        <table id="trade-table">
                            <thead>
                                <tr>
                                    <th title="‰∫§ÊòìËÆ∞ÂΩïÊó∂Èó¥">Time</th>
                                    <th title="ÂºÄ‰ªìÂë®Êúü">Open</th>
                                    <th title="Âπ≥‰ªìÂë®Êúü">Close</th>
                                    <th title="‰∫§ÊòìÂØπ">Symbol</th>
                                    <th title="ÂºÄ‰ªì‰ª∑Ê†º">Entry Price</th>
                                    <th title="ÊåÅ‰ªìÈáëÈ¢ù (Âê´Êù†ÊùÜ)">Pos Value</th>
                                    <th title="Âπ≥‰ªì‰ª∑Ê†º">Exit Price</th>
                                    <th title="Áõà‰∫èÈáëÈ¢ù">PnL</th>
                                    <th title="Áõà‰∫èÊØî‰æã">PnL %</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- JS Populated -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- Row 3: Logs (Full Width) -->
            <section class="row-logs">
                <div class="glass-panel card compound-card">
                    <div class="compound-header">
                        <h2>üì° Live Log Output</h2>
                    </div>
                    <div class="compound-body split-log-view">
                        <!-- Documentation Sidebar -->
                        <div class="agent-docs-sidebar custom-scroll">
                            <div class="agent-doc-item">
                                <h4 class="agent-title oracle">üïµÔ∏è DataSyncAgent (The Oracle)</h4>
                                <p class="role"><strong>Role:</strong> Unified data provider, aligns time-space.</p>
                                <ul>
                                    <li><strong>Async Fetch:</strong> Multi-timeframe (5m/15m/1h) + Funding Rates.</li>
                                    <li><strong>Snapshot Alignment:</strong> All data from same "time slice".</li>
                                    <li><strong>Dual View:</strong> Stable (closed) and Live (real-time) views.</li>
                                </ul>
                            </div>
                            <div class="agent-doc-item">
                                <h4 class="agent-title strategist">üë®‚Äçüî¨ QuantAnalystAgent (The Strategist)</h4>
                                <p class="role"><strong>Role:</strong> Signal generator with multi-dimensional analysis.
                                </p>
                                <ul>
                                    <li><strong>TrendSubAgent:</strong> Focus on trends (EMA/MACD).</li>
                                    <li><strong>OscillatorSubAgent:</strong> Focus on reversals (RSI/BB).</li>
                                    <li><strong>SentimentSubAgent:</strong> Focus on sentiment (Funding/OI).</li>
                                </ul>
                            </div>
                            <div class="agent-doc-item">
                                <h4 class="agent-title prophet">üîÆ PredictAgent (The Prophet)</h4>
                                <p class="role"><strong>Role:</strong> ML-powered predictor with probability output.</p>
                                <ul>
                                    <li><strong>LightGBM Model:</strong> 50+ features, auto-train every 2h.</li>
                                    <li><strong>Probability:</strong> Predicts 30-min price direction (0-100%).</li>
                                    <li><strong>Factor Analysis:</strong> SHAP-based feature importance.</li>
                                </ul>
                            </div>
                            <div class="agent-doc-item">
                                <h4 class="agent-title critic">‚öñÔ∏è DecisionCoreAgent (The Critic)</h4>
                                <p class="role"><strong>Role:</strong> Adversarial judge with final decision.</p>
                                <ul>
                                    <li><strong>Regime Detection:</strong> Identifies Trending vs Choppy markets.</li>
                                    <li><strong>Position Awareness:</strong> Price location in historical range.</li>
                                    <li><strong>Weighted Voting:</strong> Dynamic weight adjustment per regime.</li>
                                </ul>
                            </div>
                            <div class="agent-doc-item">
                                <h4 class="agent-title guardian">üõ°Ô∏è RiskAuditAgent (The Guardian)</h4>
                                <p class="role"><strong>Role:</strong> Independent auditor with veto power.</p>
                                <ul>
                                    <li><strong>R/R Check:</strong> Minimum 2:1 reward-to-risk ratio.</li>
                                    <li><strong>Drawdown Protection:</strong> Auto-halt on max drawdown.</li>
                                    <li><strong>Contra-Trend Block:</strong> Prevents counter-trend trades.</li>
                                </ul>
                            </div>
                        </div>

                        <!-- Logs Terminal -->
                        <div id="logs-container" class="logs-scroll custom-scroll">
                            <!-- JS Populated -->
                        </div>
                    </div>
                </div>
            </section>

        </main>
        </main>
    </div>
    <script src="/static/app.js"></script>
</body>

</html>